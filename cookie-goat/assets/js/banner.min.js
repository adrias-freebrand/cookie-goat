(function (w, d) {"use strict";var data = w.cookiegoatData || {};var container = d.querySelector('.cookiegoat-container');if (!container) {return;}var modal = d.getElementById('cookiegoat-modal');var floating = container.querySelector('.cookiegoat-floating');var focusableSelectors = 'button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])';var categories = data.categories || {};var state = normalize(data.consent || {});var lastFocus = null;function normalize(consent) {var result = { status: 'denied', categories: {} };Object.keys(categories).forEach(function (key) {if (key === 'necessary') {result.categories[key] = true;return;}var granted = consent.categories && typeof consent.categories[key] !== 'undefined' ? !!consent.categories[key] : false;result.categories[key] = granted;});if (consent.status === 'given') {result.status = 'given';}return result;}function toggleBanner(show) {container.setAttribute('data-visible', show ? '1' : '0');}toggleBanner(state.status !== 'given');function openModal() {if (!modal) {return;}modal.removeAttribute('hidden');lastFocus = d.activeElement;var focusable = modal.querySelectorAll(focusableSelectors);if (focusable.length) {focusable[0].focus();}}function closeModal() {if (!modal) {return;}modal.setAttribute('hidden', '');if (lastFocus && typeof lastFocus.focus === 'function') {lastFocus.focus();}}function setToggleStates(obj) {if (!modal) {return;}modal.querySelectorAll('.cookiegoat-category').forEach(function (item) {var cat = item.getAttribute('data-category');var input = item.querySelector('input[type="checkbox"]');if (!cat || !input) {return;}input.checked = !!obj[cat];});}setToggleStates(state.categories);function setClientCookie(consent) {try {var days = parseInt(data.settings && data.settings.consentExpiration, 10);if (isNaN(days) || days <= 0) {days = 365;}var expires = new Date(Date.now() + days * 24 * 60 * 60 * 1000);var cookie = 'cookiegoat_consent=' + encodeURIComponent(JSON.stringify(consent)) + ';expires=' + expires.toUTCString() + ';path=' + (data.cookiePath || '/');if (data.cookieDomain) {cookie += ';domain=' + data.cookieDomain;}cookie += ';SameSite=Lax';if (location.protocol === 'https:') {cookie += ';Secure';}document.cookie = cookie;} catch (e) {console.warn('CookieGOAT: unable to persist consent cookie', e);}}function sendConsent(status, decisions) {var payload = { status: status, categories: decisions };return fetch(data.ajaxUrl, {method: 'POST',credentials: 'include',headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },body: new URLSearchParams({action: 'cookiegoat_update_consent',nonce: data.nonce,data: JSON.stringify(payload)}).toString()}).then(function (resp) {if (!resp.ok) {throw new Error('request-failed');}return resp.json();});}function updateGCM(decisions, status) {var granted = {ad_storage: decisions.marketing ? 'granted' : 'denied',analytics_storage: decisions.analytics ? 'granted' : 'denied',ad_user_data: decisions.marketing ? 'granted' : 'denied',ad_personalization: decisions.marketing ? 'granted' : 'denied'};if (typeof gtag === 'function') {gtag('consent', 'update', granted);if (status !== 'given' || !decisions.marketing) {gtag('set', 'ads_data_redaction', true);gtag('set', 'url_passthrough', true);}}w.cookiegoatGCM = w.cookiegoatGCM || {};w.cookiegoatGCM.lastState = granted;}function finish(consent) {state = normalize(consent);setToggleStates(state.categories);setClientCookie(consent);toggleBanner(state.status !== 'given');updateGCM(state.categories, state.status);}function collectDecisions() {var result = {};Object.keys(categories).forEach(function (key) {if (key === 'necessary') {result[key] = true;return;}var field = modal ? modal.querySelector('.cookiegoat-category[data-category="' + key + '"] input[type="checkbox"]') : null;result[key] = field ? field.checked : false;});return result;}function handleChoice(status, decisions) {sendConsent(status, decisions).then(function (response) {if (response && response.success && response.data && response.data.consent) {finish(response.data.consent);}}).catch(function () {toggleBanner(true);});}container.addEventListener('click', function (evt) {var target = evt.target;var action = target.getAttribute('data-action');if (!action) {return;}evt.preventDefault();if (action === 'accept') {var acceptDecisions = {};Object.keys(categories).forEach(function (k) {acceptDecisions[k] = true;});acceptDecisions.necessary = true;handleChoice('given', acceptDecisions);closeModal();} else if (action === 'reject') {var rejectDecisions = {};Object.keys(categories).forEach(function (k) {rejectDecisions[k] = false;});rejectDecisions.necessary = true;handleChoice('denied', rejectDecisions);closeModal();} else if (action === 'configure') {openModal();}});if (floating) {floating.addEventListener('click', function () {openModal();});}if (modal) {modal.addEventListener('click', function (evt) {if (evt.target === modal) {closeModal();}});modal.querySelectorAll('.cookiegoat-close, .cookiegoat-cancel').forEach(function (btn) {btn.addEventListener('click', function () {closeModal();});});var save = modal.querySelector('.cookiegoat-save');if (save) {save.addEventListener('click', function () {var decisions = collectDecisions();var status = 'given';handleChoice(status, decisions);closeModal();});}}d.addEventListener('keydown', function (evt) {if (evt.key === 'Escape' && modal && !modal.hasAttribute('hidden')) {evt.preventDefault();closeModal();}});d.querySelectorAll('[data-cookiegoat-open]').forEach(function (btn) {btn.addEventListener('click', function () {openModal();});});if (state.status === 'given') {updateGCM(state.categories, state.status);} else {updateGCM(state.categories, 'denied');}})(window, document);
